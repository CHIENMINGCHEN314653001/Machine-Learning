Show that the sliced score matching (SSM) loss can also be written as

$$**L_{SSM}=\mathbb{E}_{x\sim p(x)} \mathbb{E}_{v\sim p(v)} \left[\|v^TS(x;\theta)\|^2+2v^T\nabla_x (v^TS(x;\theta))\right].**$$

<br></br>
**Sol:**

Let $$p_v(t)$$ be the marginal distribution of $$x$$ projected onto the direction $$v$$ , and $$s_v(t)$$ be its score function:

$$p_v(t)=\int_{\mathbb{R}^d} p(x)\\delta(t-v^\top x)dx ,\qquad s_v(t)=\frac{d}{dt}\log p_v(t)=\frac{p_v'(t)}{p_v(t)}.$$

The score function in $\mathbb{R}^d$ is $S(x)=\nabla_x\log p(x)$.


<br></br>

Applying the derivative property of the Dirac delta function,

$$\delta'(t-v^\top x) = -(v^\top \nabla_x)\delta(t-v^\top x)$$ 

and integration by parts:

$$\begin{aligned}p_v'(t)
&=\frac{d}{dt}\int p(x)\delta(t-v^\top x)dx
=\int p(x)\delta'(t-v^\top x)dx\\
&=\int p(x)(-v^\top\nabla_x)\delta(t-v^\top x)dx
=\int v^\top\nabla_x p(x)\delta(t-v^\top x)dx.
\end{aligned}
$$

Thus, $$s_v(t)$$ is:

$$s_v(t)=\frac{1}{p_v(t)}\int v^\top\nabla_x p(x)\delta(t-v^\top x)dx
=\frac{1}{p_v(t)}\int p(x)v^\top S(x)\delta(t-v^\top x)dx.$$

Differentiating $p_v'(t)$ again with respect to $t$ and integrating by parts:

$$\begin{aligned}p_v''(t)
&=\frac{d}{dt}\int v^\top\nabla_x p(x)\delta(t-v^\top x)dx
=\int v^\top\nabla_x p(x)\delta'(t-v^\top x)dx\\
&=\int v^\top\nabla_x p(x)(-v^\top\nabla_x)\delta(t-v^\top x)dx
=\int v^\top\nabla_x\big(v^\top\nabla_x p(x)\big)\delta(t-v^\top x)dx.
\end{aligned}$$

Computing the expectation of $s_v'(t)$ over $t \sim p_v$:

$$\begin{aligned}\mathbb{E}_{t\sim p_v}[s_v'(t)]
&=\int p_v(t)s_v'(t)dt
=\int p_v(t)\frac{p_v''(t)p_v(t)-p_v'(t)^2}{p_v(t)^2}dt\\
&=\int \frac{p_v''(t)}{p_v(t)}p_v(t)dt-\int\frac{p_v'(t)^2}{p_v(t)}dt
=\int p_v''(t)dt-\int\frac{p_v'(t)^2}{p_v(t)}dt\\
&=\Big[p_v'(t)\Big]_{-\infty}^{\infty}-\int\frac{p_v'(t)^2}{p_v(t)}dt
=-\int\frac{p_v'(t)^2}{p_v(t)}dt\end{aligned}$$


$$\mathbb{E}_{t\sim p_v}[s_v(t)^2]=\int p_v(t)s_v(t)^2dt=\int\frac{p_v'(t)^2}{p_v(t)}dt.$$

Hence

$$\int p_v(t)\big[s_v(t)^2+2s_v'(t)\big]dt
=\int\frac{p_v'(t)^2}{p_v(t)}dt+2\Big(-\int\frac{p_v'(t)^2}{p_v(t)}dt\Big)
=-\int\frac{p_v'(t)^2}{p_v(t)}dt.
$$

$$\begin{aligned}
\int p_v(t)\big[s_v(t)^2+2s_v'(t)\big]dt
&=\int \frac{p_v'(t)^2}{p_v(t)}dt + 2\int p_v(t)s_v'(t)dt\\
&=\int \frac{\big(\int v^\top\nabla_x p(x)\delta(t-v^\top x)dx\big)^2}{\int p(x)\delta(t-v^\top x)dx}dt
+2\int p_v(t)s_v'(t)dt.
\end{aligned}$$

By changing the integration variable from $$t$$ to $$x$$ using 

$$\int f(t)\delta(t-v^\top x)dt=f(v^\top x)$$ 

and Fubini's theorem and substituting the derivative expression for $$s_v'(t)$$

$$
\int p_v(t)\big[s_v(t)^2+2s_v'(t)\big]dt
=\int p(x)\Big[(v^\top S(x))^2 + 2v^\top\nabla_x\big(v^\top S(x;\theta)\big)\Big]dx.
$$

<br></br>

$$L_{\mathrm{SSM}}=\mathbb{E}_{v\sim p(v)}\mathbb{E}_{t\sim p_v}\big[s_v(t)^2+2s_v'(t)\big]$$

Interchanging the expectations 

$$\mathbb{E}_{v\sim p(v)}\int p(x) (\dots) dx = \mathbb{E}_{x\sim p(x)}\mathbb{E}_{v\sim p(v)}(\dots):$$

$$
\boxed{L_{\mathrm{SSM}}
=\mathbb{E}_{x\sim p(x)}\mathbb{E}_{v\sim p(v)}\Big[(v^\top S(x;\theta))^2+2v^\top\nabla_x\big(v^\top S(x;\theta)\big)\Big].}
$$

Hence

$$
\boxed{\mathcal{L}_{\mathrm{SSM}}
=\mathbb{E}_{x\sim p(x)}\mathbb{E}_{v\sim p(v)}\Big[\|v^\top S(x;\theta)\|^2+2v^\top\nabla_x\big(v^\top S(x;\theta)\big)\Big].}
$$
